{{ define "org_team" }}
{{ template "part_head_start" . }}
{{ template "part_head_end_org" . }}
<body>
{{ template "part_org_nav" . }}

{{ $now := .Now }}
{{ $basedir := .Basedir }}
{{ $game := .GameConfig }}

<main>
<h2>Detail t√Ωmu {{ .Team.Config.Name }}</h2>

<div class="row">

<div class="col-sm">
<h3>Konfigurace</h3>

<table class="table table-sm">
	<tr><td>ID</td><td><code>{{ .Team.Config.ID }}</code></td></tr>
	{{ if .Team.Config.SMSCode }}
	<tr><td>SMS k√≥d</td><td><code>{{ .Team.Config.SMSCode }}</code></td></tr>
	{{ end }}
	<tr><td>Login</td><td><code>{{ .Team.Config.Login }}</code></td></tr>
	<tr><td>Heslo</td><td>
		<label class="toggle-label" for="password-toggle">üëÅ</label>
		<input class="toggle-checkbox" id="password-toggle" type="checkbox">
		<code class="toggle-invisible">{{ .Team.Config.Password }}</code>
		<img class="toggle-hidden" src="{{ $basedir }}/org/qr-gen?text={{ .TeamLoginLink }}" title="{{ .TeamLoginLink }}">
	</td></tr>
	{{ if .Team.Config.Jitsi }}
	<tr><td>Jitsi meeting</td><td><a target="_blank" href="https://meet.jit.si/{{ .Config.Jitsi }}"><code>{{ .Config.Jitsi }}</code></a></td></tr>
	{{ end }}
	{{ if .Team.Config.Members -}}
	<tr><td>ƒålenov√©</td><td><ul>
		{{ range $name, $contact := .Team.Config.Members -}}
			<li>{{ contact_link $name $contact }}</li>
		{{- end }}
		</ul></td></tr>
	{{ end -}}
</table>
</div>

<div class="col-sm">
<h3>Status</h3>

<table class="table table-sm">
	{{ if eq $game.OrderMode "points" }}<tr><td>Z√≠skan√© body</td><td><b>{{ .Team.Points }}</b></td></tr>{{ end }}
	{{ if .Team.Locations }}
	<tr><td>Z√°znam trasy</td><td>{{ len .Team.Locations }} bod≈Ø <a href="{{ $basedir }}/org/team/{{ .Team.Config.ID }}/gpx">[st√°hnout gpx]</a></td></tr>
	<tr><td>Posledn√≠ pohyb</td><td>{{ .Team.Status.LastMoved | timestamp }}</td></tr>
	{{ end }}
	{{ if eq $game.Mode "online-map"}}<tr><td>Cooldown</td><td>{{ if .Status.CooldownTo }}{{ if $now.Before .Status.CooldownTo }}{{ .Status.CooldownTo | timestamp }}{{ end }}{{ end }}</td></tr>{{ end }}
	<tr><td>Pou≈æito n√°povƒõd</td><td>{{ .Team.Stats.UsedHints }}</td></tr>
	<tr><td>Pou≈æito p≈ôeskoƒçen√≠</td><td>{{ .Team.Stats.UsedSkips }}</td></tr>
</table>

</div>
</div>

{{ if .Ciphers.Ciphers }}
<h3>≈†ifry <small>({{ .Team.Stats.FoundCiphers }}/{{ len .Ciphers.Ciphers }} nalezeno, {{ .Team.Stats.SolvedCiphers }}/{{ len .Ciphers.Ciphers }} vy≈ôe≈°eno)</small></h3>
</main>

<main class="wide">
<table id="dashboard">
<thead class="thead-light"><tr>
	{{ template "org_table_header" dict "Ciphers" .Ciphers.Ciphers}}
</tr></thead>
<tr>
	{{ template "org_table_row" dict "Ciphers" .Ciphers.Ciphers "Game" .GameConfig "Team" .Team "Type" "single" }}
</tr><tr>
	{{ range .Ciphers.Ciphers }}
	<td><a href="{{ basedir }}/org/team/{{ $.Team.Config.ID }}/cipher/{{ .ID }}">Detaily</a></td>
	{{- end }}
</tr>
</table>
</main>
<main>
{{ end }}

{{ if .Ciphers.MiniCiphers }}
<h3>≈†if≈ôiƒçky <small>({{ .Team.Stats.FoundMiniCiphers }}/{{ len .Ciphers.MiniCiphers }} nalezeno, {{ .Team.Stats.SolvedMiniCiphers }}/{{ len .Ciphers.MiniCiphers }} vy≈ôe≈°eno)</small></h3>
</main>

<main class="wide">
<table id="dashboard">
<thead class="thead-light"><tr>
	{{ template "org_table_header" dict "Ciphers" .Ciphers.MiniCiphers}}
</tr></thead>
<tr>
	{{ template "org_table_row" dict "Ciphers" .Ciphers.MiniCiphers "Game" .GameConfig "Team" .Team "Type" "single" }}
</tr><tr>
	{{ range .Ciphers.MiniCiphers }}
	<td><a href="{{ basedir }}/org/team/{{ $.Team.Config.ID }}/cipher/{{ .ID }}">Detaily</a></td>
	{{- end }}
</tr>
</table>
</main>
<main>
{{ end }}

{{ if .Ciphers.Simple }}
<h3>Stanovi≈°tƒõ <small>({{ .Team.Stats.FoundSimple }}/{{ len .Ciphers.Simple }} nalezeno)</small></h3>
<div class="cipher-simple-wrap">
{{ range .Ciphers.Simple }}
	{{- $status := index $.Team.Ciphers .ID -}}
	<div class="cipher-simple{{ if not $status.Arrival.IsZero }} found{{ end }}">
		<div class="title">{{ if .File }}<a title="St√°hnout" href="{{ basedir }}/org/cipher/{{ .ID }}/download">{{ .Name }}</a>{{ else }}{{ .Name }}{{ end }}</div>
		<div class="body">
			<a title="Detail" href="{{ basedir }}/org/team/{{ $.Team.Config.ID }}/cipher/{{ .ID }}">
			{{ if not $status.Arrival.IsZero }}<span class="status-arrival" title="ƒåas p≈ô√≠chodu">{{ $status.Arrival | timestamp_hint }}</span>
			{{else}}‚Äî{{ end }}
			</a>
		</div>
	</div>
{{ end }}
</div><br>
{{ end }}

<h3>Zpr√°vy <small>({{ len .Team.Messages}})</small></h3>

<table class="table table-bordered table-striped" id="history">
	<thead>
		<tr><th>ƒåas</th><th>Zdroj</th><th>≈†ifra</th><th>Zpr√°va od t√Ωmu</th><th>Odpovƒõƒè</th></tr>
	</thead>
	<tbody>
		{{ range .Team.Messages}}
		<tr>
			<td>{{ .Time | timestamp_hint }}</td>
			<td>{{ if .SMSID }}<a href="tel:{{ .PhoneNumber }}">{{ .PhoneNumber }}</a>{{ else }}{{ .PhoneNumber }}{{ end }}</td>
			<td>{{ if .Cipher }}
				{{ $c := index $.CiphersMap .Cipher }}
				{{ if $c }}<a href="{{ basedir }}/org/team/{{ $.Team.Config.ID }}/cipher/{{ $c.ID }}">{{ $c.Name }}</a>{{ else }}???{{ end }}
			{{ end }}</td>
			<td>{{ .Text }}</td>
			<td>{{ .Response | safeHTML }}</td>
		</tr>
		{{ end }}
	</tbody>
</table>

</main>

</body>
</html>
{{ end }}
