{{ define "org_team_cipher" }}
{{ template "part_head_start" . }}
{{ template "part_head_end_org" . }}
<body>
{{ template "part_org_nav" . }}

{{ $now := .Now }}
{{ $basedir := .Basedir }}
{{ $game := .GameConfig }}

<main>
<h2><a href="{{ $basedir }}/org/team/{{ .Team.ID }}">TÃ½m {{ .Team.Name }}</a> â€“ Å ifra {{ .Cipher.Name }}</h2>

<div class="row">

<div class="col-sm">
<h3>Detaily Å¡ifry</h3>

<table class="table table-sm">
	<tr><td>ID</td><td><code>{{ .Cipher.ID }}</code></td></tr>
	{{ if .Cipher.NotCipher }}<tr><td>NenÃ­ Å¡ifra</td></tr>{{ end }}
	{{ if .Cipher.DependsOn }}
	{{ $multiple := gt (len .Cipher.DependsOn) 1 }}
	<tr><td title="Nutno objevit pÅ™ed objevenÃ­m tÃ©to Å¡ifry">ZÃ¡vislosti</td><td>
		{{ range $i, $dep := .Cipher.DependsOn }}
			{{ if $multiple }}Varianta {{ $i }}: {{ end }}
			{{- $first := true -}}
			{{ range $cid := $dep -}}
				{{- $cipher := index $.CiphersMap $cid -}}
				{{- $cipherStatus := index $.CiphersStatus $cid -}}
				{{- if $first }}{{ $first = false }}{{ else }}, {{ end -}}
				{{ if and $cipherStatus $cipherStatus.Solved }}âœ…{{ else if and $cipherStatus $cipherStatus.Skip }}â©{{ else }}âŒ{{ end }}
				<a href="{{ $basedir }}/org/team/{{ $.Team.ID }}/cipher/{{ $cid }}">{{ $cipher.Name }}</a>
			{{- end }}
			<br>
		{{ end }}
	</td></tr>
	{{ end }}
	{{ if .Cipher.ArrivalCode }}<tr><td>KÃ³d pÅ™i pÅ™Ã­chodu</td><td><code>{{ .Cipher.ArrivalCode }}</code></td></tr>{{ end }}
	{{ if .Cipher.ArrivalText }}<tr><td>PÅ™Ã­chodovÃ¡ zprÃ¡va</td><td>{{ .Cipher.ArrivalText }}</td></tr>{{ end }}
	{{ if .Cipher.AdvanceCode }}<tr><td>PostupovÃ© heslo</td><td><code>{{ .Cipher.AdvanceCode }}</code></td></tr>{{ end }}
	{{ if .Cipher.AdvanceText }}<tr><td>PostupovÃ¡ zprÃ¡va</td><td>{{ .Cipher.AdvanceText }}</td></tr>{{ end }}
	{{ if .Cipher.HintText }}<tr><td>NÃ¡povÄ›da</td><td>{{ .Cipher.HintText }}</td></tr>{{ end }}
	{{ if .Cipher.SkipText }}<tr><td>PÅ™eskoÄenÃ­</td><td>{{ .Cipher.SkipText }}</td></tr>{{ end }}
	{{ if .Cipher.Position }}<tr><td>Pozice</td><td><a href="https://mapy.cz/turisticka?vlastni-body&x={{ .Cipher.Position.Lon }}&y={{ .Cipher.Position.Lat }}&z=15">{{ .Cipher.Position.Point | latlon_human}}</a></td></tr>{{ end }}
	{{ if .Cipher.File }}<tr><td>StÃ¡hnout</td><td><a href="{{ $basedir }}/org/cipher/{{ .Cipher.ID }}/download">{{ .Cipher.File }}</a></td></tr>{{ end }}
</table>
</div>

<div class="col-sm">
<h3>Status Å™eÅ¡enÃ­</h3>

<table class="table table-sm">
{{ if not .Found }}
	<tr><td>NalezenÃ¡:</td><td>
		âŒ Ne
		<form method="POST" class="float-right" onsubmit="return confirm('Opravdu oznaÄit jako nalezenou?');">
			{{ .CSRF }}
			<button name="submit" value="set-found" class="btn btn-sm btn-primary">OznaÄit jako nalezenou</button>
		</form>
	</td></tr>
{{ else }}
	<tr><td>NalezenÃ¡</td><td>âœ… {{ .CipherStatus.Arrival | timestamp }}
		{{- if ne .CipherStatus.Team .Team.ID }}<br><b>Nalezeno spolutÃ½mem <a href="{{ basedir }}/org/team/{{ .CipherStatus.TeamP.ID }}">{{ .CipherStatus.TeamP.Name }}</b></a>{{ end -}}
	</td></tr>
	<tr><td>VyÅ™eÅ¡enÃ¡</td><td>{{ if .CipherStatus.Solved }}âœ… {{ .CipherStatus.Solved | timestamp }}{{ else }}
		âŒ {{ if not .CipherStatus.Skip }}<form method="POST" class="float-right" onsubmit="return confirm('Opravdu oznaÄit jako vyÅ™eÅ¡enou?');">
			{{ .CSRF }}
			<button name="submit" value="set-solved" class="btn btn-sm btn-success">âœ… OznaÄit jako vyÅ™eÅ¡enou</button>
		</form>{{ end }}
	{{ end }}</td></tr>
	<tr><td>NÃ¡povÄ›da</td><td>{{ if .CipherStatus.Hint }}ğŸ’¡ vydanÃ¡ {{ .CipherStatus.Hint | timestamp }}
		{{- if $game.HasMiniCipherHints }}<br>ZmÄ›na Å¡ifÅ™iÄkovÃ©ho konta: <b>{{ .CipherStatus.HintScore }}</b>
		<form method="POST" class="float-right" onsubmit="return confirm('Opravdu oznaÄit jako Å¾e nÃ¡povÄ›da byla vydÃ¡na? Pokud Å¡ifra obsahuje textovou nÃ¡povÄ›du, tak se zobrazÃ­ ÃºÄastnÃ­kÅ¯m v jejich ÄÃ¡sti systÃ©mu.');">
			{{ .CSRF }}
			<input type="number" value="0" name="add-hint-score" size="2">
			<button name="submit" value="add-hint-score" class="btn btn-sm btn-warning">PÅ™ipoÄÃ­tat</button>
		</form>
		{{ end }}
		{{ else }}
		nevydanÃ¡ {{ if not (or .CipherStatus.Skip .CipherStatus.Solved) }}<form method="POST" class="float-right" onsubmit="return confirm('Opravdu oznaÄit jako Å¾e nÃ¡povÄ›da byla vydÃ¡na? Pokud Å¡ifra obsahuje textovou nÃ¡povÄ›du, tak se zobrazÃ­ ÃºÄastnÃ­kÅ¯m v jejich ÄÃ¡sti systÃ©mu.');">
			{{ .CSRF }}
			<button name="submit" value="set-hint" class="btn btn-sm btn-warning">ğŸ’¡ Vydat nÃ¡povÄ›du</button>
		</form>{{ end }}
	{{ end }}</td></tr>
	<tr><td>PÅ™eskoÄenÃ­</td><td>{{ if .CipherStatus.Skip }}â© pÅ™eskoÄeno {{ .CipherStatus.Skip | timestamp }}{{ else }}
		nepÅ™eskoÄeno {{ if not .CipherStatus.Solved }}<form method="POST" class="float-right" onsubmit="return confirm('Opravdu oznaÄit jako pÅ™eskoÄenou? PotÃ© jiÅ¾ nepÅ¯jde Å¡ifru vyÅ™eÅ¡it a v ÃºÄastnickÃ© ÄÃ¡sti systÃ©mu se zobrazÃ­ text pÅ™eskoÄenÃ­.');">
			{{ .CSRF }}
			<button name="submit" value="set-skip" class="btn btn-sm btn-danger">â© PÅ™eskoÄit Å¡ifru</button>
		</form>{{ end }}
	{{ end }}</td></tr>
	{{ if $game.HasPoints}}
	{{ if not .CipherStatus.Skip }}
	<tr><td>Extra body</td><td>
		<form method="POST">
			{{ .CSRF }}
			<input type="number" value="{{ .CipherStatus.ExtraPoints }}" name="extra-points">
			<button name="submit" value="set-extra-points" class="btn btn-sm btn-primary">Nastavit</button>
		</form>
	</td></tr>
	{{ end }}
	<tr><th class="hint" title="VÄetnÄ› extra bodÅ¯">ZÃ­skanÃ© body</th><th>{{ .CipherStatus.Points }}</th></tr>
	{{ end }}
{{ end }}
</table>

</div>
</div>

<h3>ZprÃ¡vy k tÃ©to Å¡ifÅ™e</h3>

<table class="table table-bordered table-striped" id="history">
	<thead>
		<tr><th>ÄŒas</th><th>Zdroj</th><th>ZprÃ¡va od tÃ½mu</th><th>OdpovÄ›Ä</th></tr>
	</thead>
	<tbody>
		{{ range .Messages}}
		<tr>
			<td>{{ .Time | timestamp_hint }}</td>
			<td>{{ if .SMSID }}<a href="tel:{{ .PhoneNumber }}">{{ .PhoneNumber }}</a>{{ else }}{{ .PhoneNumber }}{{ end }}</td>
			<td>{{ .Text }}</td>
			<td>{{ .Response | safeHTML }}</td>
		</tr>
		{{ end }}
	</tbody>
</table>

</main>

</body>
</html>
{{ end }}
