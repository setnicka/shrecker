{{ define "part_org_index_dashboard" }}

{{ $now := .Now }}
{{ $basedir := .Basedir }}
{{ $game := .GameConfig }}

<div class="float-right" style="font-weight: bold;">
{{ if .GameConfig.NotStarted $now }}Hra začíná v {{ .GameConfig.Start | timestamp }}
{{- else if .GameConfig.Ended $now }}Hra skončila v {{ .GameConfig.End | timestamp }}
{{- else if .GameConfig.HasEnd }}Hra končí v {{ .GameConfig.End | timestamp }}{{ end }}
</div>

<h2>Stav hry</h2>

{{ template "part_messageBox" . }}

<table id="dashboard" class="full">
<thead class="thead-light"><tr>
	<th>Tým</th>
	{{ template "org_table_header" dict "Ciphers" .Ciphers }}
</tr></thead>
{{ range .Teams }}
	<tr>
		<th>
			<a href="{{ basedir }}/org/team/{{ .Config.ID }}" title="Detail týmu">{{ .Config.Name }}</a>
			{{ if $.GameConfig.HasMap }}<br><a href="#" onclick="showPath('{{ .Config.ID }}'); return false;"><small>zobrazit na mapě</small></a>{{ end }}
			{{- if eq $.GameConfig.OrderMode "points" }}<br>Bodů: {{ .Points }}{{ end -}}
		</th>
		{{ template "org_table_row" dict "Ciphers" $.Ciphers "Game" $.GameConfig "Team" . "Type" "dashboard" }}
	</tr>
{{ end }}
</table>

<script type="text/javascript">
// Hloupá pravidelná kontrola, jestli se něco změnilo
setInterval(function() {
	$.ajax({
		url: '{{ .Basedir }}/org/api/hash',
		type: 'GET',
		success: function (data) {
			if (data != '{{ .GameHash }}') {
				window.location.reload();
			}
		}
	});
}, 10_000);
</script>

{{ end }}
